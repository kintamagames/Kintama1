<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sky Escape</title>
    <style>
        body { margin: 0; overflow: hidden; background: #87CEEB; touch-action: none; font-family: sans-serif; }
        canvas { display: block; width: 100vw; height: 100vh; }
        #menu-btn { position: fixed; top: 10px; right: 10px; padding: 12px 20px; background: #000; color: #fff; border: 2px solid #fff; border-radius: 8px; text-decoration: none; font-size: 16px; font-weight: bold; z-index: 9999; }
    </style>
</head>
<body>
    <a href="index.html" id="menu-btn">MENU</a>
    <canvas id="g"></canvas>
    <script>
        const canvas = document.getElementById('g');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        let score = 0, active = true, py = canvas.height/2, pv = 0, obs = [], lastX = 0;

        function jump(e) {
            if (e.target.id === 'menu-btn') return;
            if (e.cancelable) e.preventDefault();
            if (!active) { location.reload(); return; }
            pv = -7;
        }
        // ウェブの枠内でも反応するようにdocumentに登録
        document.addEventListener('touchstart', jump, { passive: false });
        document.addEventListener('mousedown', jump);

        function loop() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (active) {
                pv += 0.4; py += pv;
                if (py > canvas.height || py < 0) active = false;
                if (canvas.width - lastX > canvas.width * 0.6) {
                    let gap = 180, min = canvas.height*0.2, max = canvas.height*0.8-gap;
                    let gt = Math.random()*(max-min)+min;
                    obs.push({x: canvas.width, gt: gt, gb: gt+gap});
                    lastX = canvas.width;
                }
                for (let i = obs.length-1; i >= 0; i--) {
                    obs[i].x -= 4; if (i === obs.length-1) lastX = obs[i].x;
                    if (obs[i].x < -60) { obs.splice(i, 1); score++; }
                    else if (50+15 > obs[i].x && 50-15 < obs[i].x+60) {
                        if (py-15 < obs[i].gt || py+15 > obs[i].gb) active = false;
                    }
                }
            }
            ctx.fillStyle = "#f1c40f"; ctx.beginPath(); ctx.arc(50, py, 15, 0, 7); ctx.fill();
            ctx.fillStyle = "#2ecc71";
            obs.forEach(o => { ctx.fillRect(o.x, 0, 60, o.gt); ctx.fillRect(o.x, o.gb, 60, canvas.height-o.gb); });
            ctx.fillStyle = "white"; ctx.font = "bold 24px Arial"; ctx.fillText("SCORE: " + score, 20, 40);
            if (!active) {
                ctx.fillStyle = "rgba(0,0,0,0.7)"; ctx.fillRect(0,0,canvas.width,canvas.height);
                ctx.fillStyle="white"; ctx.textAlign="center"; ctx.font="30px Arial"; ctx.fillText("GAME OVER", canvas.width/2, canvas.height/2);
            }
            requestAnimationFrame(loop);
        }
        loop();
    </script>
</body>
</html>
